# 描边-法线外扩
仍然是从[csdjk的库](https://github.com/csdjk/LearnUnityShader/tree/master/Assets/Scenes/OutLine/NormalExpansion)中复制的代码, 基本没有改动.
基本原理就是: 正向渲染画一个pass, 反面先**以法线方向**外扩一定单位, 然后画纯色.

原理很简单, 为了在使描边半径不受摄像机距离影响, 可以在NDC空间下进行外扩距离的计算.

## 学到的其它经验
1. 显然, shaderlab也能用#ifdef这一系列的宏. 但在这一案例中可以看到, 这个宏的值可以在 Material 面板中用一个勾选框来指定值. 这让人感觉非常 Amazing. 推测```#pragma multi_compile _ _USE_SMOOTH_NORMAL_ON```一行的作用就是分别编译无宏和有宏的两个版本, 材质参数的更改实际上是使用了不同的 shader 编译版本.
2. 一个从模型空间转换到NDC空间的例程. 具体数学原理待补充.

## 存在的问题
问题很明显, 在**棱角尖锐**的模型下, 由于模型同一个顶点在不同面的渲染上具有差别显著的法线方向, 按照法线外扩出来的各个面就会分离. 这一点在正方体上表现得最明显. 与之相对应的, 球体的描边就比较规整.

当然, 即使不考虑外扩散架的问题, 这种描边的效果也远谈不上理想. 或许描边也使用某种纹理映射上去会有更好的效果? 比如, 用裁剪空间的坐标当uv来取纹理, 应该可以得到具有纹路的边缘线条.

## 仍未掌握的知识盲区
为什么要 tangent 就是平滑法线了, 实际效果明明就是往侧面平移了... 难道是 Stencil 这一块有奇妙的魔法?

